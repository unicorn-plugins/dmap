# DMAP 플러그인 개발 가이드

- [DMAP 플러그인 개발 가이드](#dmap-플러그인-개발-가이드)
  - [개요](#개요)
  - [요구사항 정의서](#요구사항-정의서)
    - [정의서 작성 양식](#정의서-작성-양식)
    - [작성 예시](#작성-예시)
  - [플러그인 개발 워크플로우](#플러그인-개발-워크플로우)
    - [Phase 1: 요구사항 수집](#phase-1-요구사항-수집)
    - [Phase 2: 설계 및 계획](#phase-2-설계-및-계획)
    - [Phase 3: 플러그인 개발](#phase-3-플러그인-개발)
    - [Phase 4: 검증 및 완료](#phase-4-검증-및-완료)
  - [에이전트 유형 참조](#에이전트-유형-참조)
    - [기본 유형](#기본-유형)
    - [확장 유형](#확장-유형)
    - [도메인 특화 유형](#도메인-특화-유형)
    - [유형 선택 가이드](#유형-선택-가이드)
    - [4-Tier 모델](#4-tier-모델)
  - [플러그인 적합여부 판단 기준](#플러그인-적합여부-판단-기준)
  - [참조 표준 문서](#참조-표준-문서)

---

## 개요

DMAP 빌더를 이용하여 선언형 멀티에이전트 플러그인을 개발하는 가이드.
사용자는 요구사항 정의서를 작성하고, AI가 DMAP 표준에 맞춰 플러그인을 자동 생성함.

**가이드 구성:**

| 구분 | 내용 | 대상 |
|------|------|------|
| 요구사항 정의서 | 사용자가 작성하는 플러그인 요구사항 양식 | 사용자 |
| 플러그인 개발 워크플로우 | AI가 수행하는 단계별 개발 절차 | AI (DMAP 빌더) |

**Phase별 사용자 확인:**

각 Phase 완료 시 사용자에게 진행 결과를 보고하고 승인을 받은 후 다음 Phase로 진행.

[Top](#dmap-플러그인-개발-가이드)

---

## 요구사항 정의서

사용자가 플러그인 개발을 요청할 때 작성하는 입력 양식.
모든 항목을 작성할 필요 없으며, 미작성 항목은 AI가 문의하여 보완.

### 정의서 작성 양식

```markdown
# 요구사항 정의서

## 기본 정보
- 플러그인명: {영문 kebab-case. 예: my-plugin}
- 목적: {플러그인이 해결하는 문제 또는 달성 목표. 한 줄 요약}
- 대상 도메인: {예: 교육, 개발 자동화, 비즈니스 프로세스, 콘텐츠 제작}
- 대상 사용자: {예: 개발자, 기획자, 디자이너, 도메인 전문가}

## 핵심기능
- {핵심기능1}: {기능 설명}
- {핵심기능2}: {기능 설명}
...

## 사용자 플로우
- Step 1. {작업명}: {작업 설명}
- Step 2. {작업명}: {작업 설명}
...

## 에이전트 구성 힌트 (선택)
- {역할1}: {역할 설명. 예: "코드 작성 전문가", "문서 리뷰어"}
- {역할2}: {역할 설명}
...

## 참고 공유 자원 (선택)
- 참고 가이드: {resources/guides/에서 활용할 가이드 목록}
- 참고 샘플: {resources/samples/에서 활용할 샘플 목록}
- 참고 템플릿: {resources/templates/에서 활용할 템플릿 목록}
- 참고 도구: {resources/tools/에서 활용할 도구 목록}
```

### 작성 예시

```markdown
# 요구사항 정의서

## 기본 정보
- 플러그인명: code-reviewer
- 목적: PR(Pull Request) 코드 리뷰를 자동화하여 리뷰 품질과 속도 향상
- 대상 도메인: 소프트웨어 개발
- 대상 사용자: 개발팀 리더, 시니어 개발자

## 핵심기능
- PR 분석: PR의 변경 파일, 커밋 히스토리, 영향 범위 자동 분석
- 코드 리뷰: 코드 품질, 보안, 성능 관점에서 리뷰 코멘트 생성
- 리뷰 보고서: 리뷰 결과를 구조화된 보고서로 출력

## 사용자 플로우
- Step 1. PR 지정: 리뷰할 PR 번호 또는 브랜치 지정
- Step 2. 리뷰 실행: 자동 분석 및 리뷰 수행
- Step 3. 결과 확인: 리뷰 보고서 확인 및 코멘트 반영

## 에이전트 구성 힌트
- 분석가: PR 변경사항과 영향 범위 분석 전문가
- 리뷰어: 코드 품질/보안/성능 관점 리뷰 전문가

## 참고 공유 자원
- 참고 도구: context7 (라이브러리 문서 검색용)
```

[Top](#dmap-플러그인-개발-가이드)

---

## 플러그인 개발 워크플로우

AI(DMAP 빌더)가 수행하는 단계별 개발 절차.
각 Phase 완료 시 사용자에게 결과를 보고하고 승인을 받음.

```
Phase 1: 요구사항 수집     ──→ 사용자 확인
Phase 2: 설계 및 계획      ──→ 사용자 확인
Phase 3: 플러그인 개발     ──→ 사용자 확인
Phase 4: 검증 및 완료      ──→ 사용자 확인
```

### Phase 1: 요구사항 수집

요구사항 정의서를 분석하고, 부족한 정보를 사용자에게 문의하여 수집.

**Step 1. 요구사항 파악**

요구사항 정의서의 각 항목을 분석하고, 핵심기능과 사용자 플로우의 일관성 확인.

**Step 2. 플러그인 적합여부 판단**

요구사항이 DMAP 플러그인으로 구현하기 적합한지 판단.
부적합 시 사용자에게 검토결과 및 보완사항 추천.
판단 기준은 [플러그인 적합여부 판단 기준](#플러그인-적합여부-판단-기준) 참조.

**Step 3. 사용자에게 문의할 내용 취합**

요구사항 정의서에서 누락되거나 모호한 항목을 파악하여 질문 목록 작성.
아래 기본 항목 외에도 요구사항의 특성에 따라 충분히 문의할 내용을 취합.

**기본 확인 항목:**

- 프로젝트 디렉토리: 플러그인을 개발할 디렉토리 경로를 사용자에게 확인 (예: `{사용자홈}/workspace/my-plugin`)
- 미작성 필수 항목 (플러그인명, 목적, 핵심기능, 사용자 플로우)
- 핵심기능과 사용자 플로우 간 불일치
- 에이전트 역할 구분이 필요한 부분
- 외부 시스템 연동 여부 (API, DB, 파일 시스템 등)
- 기술 요건 (프로그래밍 언어, 프레임워크, 프로토콜, 데이터 형식 등)

**요구사항에 따른 추가 확인 (예시):**

- 인증/보안 요건 (API Key, OAuth, 접근 권한 등)
- 데이터 입출력 형식 및 저장소
- 기존 시스템과의 호환성 제약
- 성능/비용 요건 (응답 시간, 토큰 사용량 등)
- 에러 처리 및 예외 상황 대응 방침

**Step 4. 사용자에게 문의하여 정보 수집**

AskUserQuestion 도구를 활용하여 사용자에게 문의.
질문 수에 따라 1개 또는 N개씩 문의 (한 번에 최대 4개).

**Step 5. 요구사항 정의서 업데이트**

사용자 문의를 통해 수집된 정보를 요구사항 정의서에 반영.
원본 정의서의 누락/모호 항목을 보완하고, 새로 확인된 사항을 추가하여 완성된 정의서로 갱신.

결과 파일: `{프로젝트 디렉토리}/output/requirement.md`


> **Phase 1 완료**: 업데이트된 요구사항 정의서를 사용자에게 보고하고 승인 요청.

### Phase 2: 설계 및 계획

수집된 요구사항을 기반으로 플러그인 구조를 설계하고 개발 계획 수립.

**Step 1. 공유 자원 선택**

`resources/plugin-resources.md`를 참조하여 플러그인에 활용할 공유 자원 선별.

| 자원 유형 | 선택 기준 |
|----------|----------|
| 가이드 | 개발에 참고할 기술 가이드 |
| 템플릿 | 산출물 생성에 활용할 템플릿 |
| 샘플 | 구현 참고용 샘플 코드/패턴 |
| 도구 | 개발/검증에 필요한 도구 |

**Step 2. 플러그인 구조 설계**

DMAP 표준에 맞춰 플러그인의 전체 구조 설계.

| 설계 항목 | 설계 내용 | 참조 표준 |
|----------|----------|----------|
| 에이전트 구성 | 역할별 에이전트 정의 (이름, 티어, 도구) | `plugin-standard-agent.md` |
| 스킬 구성 | 스킬 목록 및 유형 결정 (Core/Setup/Planning/Orchestrator/Utility) | `plugin-standard-skill.md` |
| Gateway 설정 | 티어 매핑, 도구 매핑, 액션 매핑 | `plugin-standard-gateway.md` |
| 디렉토리 구조 | 표준 디렉토리 구조 확정 | `plugin-standard.md` |

> 스킬 구성은 `standards/plugin-standard-skill.md`를 참고하여 AI가 판단.

**Step 3. 개발 계획 수립**

`/oh-my-claudecode:ralplan` 스킬을 사용하여 개발 계획서 작성.

개발 계획서 포함 사항:
- 공유자원 마켓플레이스에서 가져갈 자원 목록
- 개발할 커스텀 앱 또는 커스텀 CLI 파악 및 개발 계획
- 공유자원 외 필요한 외부 자원(가이드, 샘플, 템플릿, 도구) 파악 및 수집 계획
- DMAP 표준 산출물 목록 및 생성 순서

결과 파일: `{프로젝트 디렉토리}/output/develop-plan.md`

**Step 4. 사용자 검토 및 보완**

사용자에게 개발 계획서 검토 요청.
피드백에 따라 계획서 보완 후 재승인.

> **Phase 2 완료**: 확정된 개발 계획서를 사용자에게 보고하고 개발 착수 승인 요청.

### Phase 3: 플러그인 개발

`/oh-my-claudecode:ralph` 스킬을 사용하여 개발 계획서에 따라 플러그인 개발.

**Step 1. 플러그인 스켈레톤 생성**

표준 디렉토리 구조와 필수 매니페스트 파일 생성.

```
{프로젝트 디렉토리}/
├── .claude-plugin/
│   ├── plugin.json              # 플러그인 매니페스트 (필수)
│   └── marketplace.json         # 마켓플레이스 매니페스트 (필수)
├── skills/
├── agents/
├── gateway/
├── commands/
└── README.md
```

> `plugin.json`과 `marketplace.json` 작성 시
> DMAP 메인 표준(`standards/plugin-standard.md`)의 `## 배포 > plugin.json`과 `## 배포 > marketplace.json` 섹션 참조.

**Step 2. Gateway 설정**

추상 선언과 구체 매핑을 연결하는 Gateway 파일 생성.

| 파일 | 내용 |
|------|------|
| `gateway/install.yaml` | MCP 서버, LSP 서버, 커스텀 도구 설치 매니페스트 |
| `gateway/runtime-mapping.yaml` | 티어→모델 매핑, 추상도구→구체도구 매핑, 금지액션→제외도구 매핑 |

> Gateway 설정이 없으면 에이전트 호출 시 모델/도구 구체화 불가.

**Step 3. 공유자원 복사**

리소스 마켓플레이스(`resources/`)에서 선별된 자원을 플러그인 디렉토리로 복사.

| 자원 유형 | 복사 위치 | 기준 |
|----------|----------|------|
| 가이드 | `agents/{name}/references/` | 에이전트가 참조하는 경우 |
| 가이드 | `skills/{name}/references/` | 스킬이 참조하는 경우 |
| 템플릿 | `agents/{name}/templates/` | 에이전트 출력 포맷인 경우 |
| 템플릿 | `skills/{name}/assets/` | 스킬이 사용하는 경우 |
| 샘플 | `agents/{name}/references/` | — |
| 도구 소스 | `gateway/tools/` | — |

**Step 4. 에이전트 개발**

에이전트별 패키지(디렉토리) 생성.

| 파일 | 필수 | 내용 |
|------|:----:|------|
| `AGENT.md` | 필수 | 프롬프트 (목표, 참조, 워크플로우, 출력 형식, 검증) |
| `agentcard.yaml` | 필수 | 메타데이터 (정체성, 역량, 제약, 핸드오프) |
| `tools.yaml` | 선택 | 추상 도구 선언 (이름, 설명, 파라미터) |
| `references/` | 선택 | 에이전트 전용 참조 문서 |

> 표준 참조: `standards/plugin-standard-agent.md`

**Step 5. 스킬 개발**

스킬별 디렉토리 및 SKILL.md 생성. setup 스킬은 반드시 포함.

| 스킬 | 유형 | 필수 | 설명 |
|------|------|:----:|------|
| setup | Setup (직결형) | 필수 | 플러그인 설치 및 초기 설정 |
| core | Core (위임형) | 필수 | 시스템 전체 행동 규범, 모호한 요청의 의도 판별 |
| help | Utility (직결형) | 권장 | 사용 가능한 명령 및 자동 라우팅 안내 |
| {기능 스킬} | Orchestrator/Planning | 상황별 | 핵심기능별 워크플로우 |

setup 스킬 필수 수행 사항:
- `gateway/install.yaml` 기반 도구 설치

setup 스킬 권장 사항:
- `help` 유틸리티 스킬 제공 (사용 가능한 명령 및 자동 라우팅 안내)

help 스킬 작성 규칙:
- SKILL.md에 명령 목록과 자동 라우팅 규칙을 **하드코딩**하여 즉시 출력하는 방식으로 작성
- 워크플로우 시작 부분에 다음 지시문 삽입:
  `**중요: 추가적인 파일 탐색이나 에이전트 위임 없이, 아래 내용을 즉시 사용자에게 출력하세요.**`
- `skills/` 디렉토리 스캔 등 런타임 탐색 금지 (토큰 낭비 방지)

> 표준 참조: `standards/plugin-standard-skill.md`

**Step 6. commands/ 진입점 생성**

슬래시 명령으로 노출할 스킬의 진입점 파일 생성.

```markdown
# commands/{skill-name}.md
---
description: {스킬 설명}
---

Use the Skill tool to invoke the `{plugin-name}:{skill-name}` skill
with all arguments passed through.
```

> 표준 참조: `standards/plugin-standard.md`의 "슬래시 명령 등록"

**Step 7. 커스텀 앱/CLI 개발**

개발 계획서에 명시된 커스텀 도구 개발.

| 단계 | 내용 |
|------|------|
| 개발 | `gateway/tools/`에 소스 파일 생성 |
| 테스트 | 단위 테스트 및 통합 테스트 수행 |
| Gateway 등록 | `install.yaml`의 `custom_tools`에 등록, `runtime-mapping.yaml`의 `tool_mapping`에 매핑 |

**Step 8. README.md 작성**

`resources/templates/plugin/README-plugin-template.md`를 참고하여 README.md 작성.

필수 섹션: 개요, 설치, 업그레이드, 사용법, 요구사항, 라이선스.

> **Phase 3 완료**: 개발된 플러그인의 구조와 기능을 사용자에게 보고하고 검증 착수 승인 요청.

### Phase 4: 검증 및 완료

개발된 플러그인이 DMAP 표준을 준수하는지 최종 검증.

**Step 1. 전체 검증**

| 검증 항목 | 확인 내용 |
|----------|----------|
| 필수 파일 | `.claude-plugin/plugin.json`, `.claude-plugin/marketplace.json` 존재 |
| 에이전트 쌍 | 모든 에이전트에 `AGENT.md` + `agentcard.yaml` 존재 |
| 스킬 구조 | 모든 스킬에 `SKILL.md` 존재, frontmatter 포함 |
| setup 스킬 | setup 스킬 존재, `disable-model-invocation` 미사용 |
| help 스킬 (권장) | help 유틸리티 스킬 존재, 명령 목록 및 자동 라우팅 규칙 안내 포함 |
| Gateway | `install.yaml` + `runtime-mapping.yaml` 존재 |
| 슬래시 명령 | `commands/` 진입점 파일 존재 |
| 도구 매핑 | `tools.yaml`의 추상 도구가 `runtime-mapping.yaml`에 매핑 |
| 티어 매핑 | `agentcard.yaml`의 tier가 `runtime-mapping.yaml`에 매핑 |
| README | 필수 섹션(개요, 설치, 사용법, 요구사항, 라이선스) 포함 |

**Step 2. 사용자에게 개발완료 보고**

최종 산출물 요약 보고:
- 플러그인 디렉토리 구조 (트리)
- 생성된 에이전트/스킬 목록
- 슬래시 명령 목록
- 설치 방법 (`/{플러그인명}:setup`)

**Step 3. 공유자원 등록 (선택)**

플러그인 개발 과정에서 새로 만든 커스텀 앱/CLI가 범용적이면
`resources/` 마켓플레이스에 등록하여 다른 플러그인에서도 재사용 가능하게 함.

| 등록 작업 | 내용 |
|----------|------|
| 소스 복사 | `resources/tools/customs/{분류}/`에 소스 파일 복사 |
| 가이드 작성 | `resources/tools/{도구명}.md` 가이드 문서 작성 |
| 카탈로그 갱신 | `resources/plugin-resources.md`의 도구 목록에 추가 |

> **Phase 4 완료**: 플러그인 개발 완료. 사용자에게 최종 보고.

[Top](#dmap-플러그인-개발-가이드)

---

## 에이전트 유형 참조

에이전트 설계 시 참고할 수 있는 대표 유형.
하나의 플러그인에 모든 유형이 필요한 것은 아니며, 요구사항에 맞는 유형만 선택.

### 기본 유형

플러그인에서 가장 빈번하게 사용되는 핵심 유형.

| 유형 | 역할 | 권장 티어 | 적합한 작업 |
|------|------|----------|------------|
| **architect** | 분석·설계 전문가 | HIGH | 구조 분석, 설계 결정, 영향 범위 평가, 코드 리뷰 |
| **executor** | 구현 전문가 | MEDIUM | 코드 작성·수정, 기능 구현, 리팩터링 |
| **explorer** | 탐색 전문가 | LOW~MEDIUM | 코드베이스 탐색, 파일 검색, 패턴 파악 |

### 확장 유형

도메인 또는 워크플로우 특성에 따라 추가 선택.

| 유형 | 역할 | 권장 티어 | 적합한 작업 |
|------|------|----------|------------|
| **planner** | 계획 수립 전문가 | HIGH | 전략 수립, 요구사항 분석, 작업 분해 |
| **reviewer** | 검토·비평 전문가 | HIGH | 품질 검증, 계획 비평, 산출물 검토 |
| **researcher** | 조사·수집 전문가 | MEDIUM | 외부 문서 조사, API 문서 검색, 기술 리서치 |
| **writer** | 문서 작성 전문가 | LOW | README, API 문서, 사용자 가이드 작성 |
| **designer** | UI/UX 전문가 | MEDIUM~HIGH | 컴포넌트 설계, 스타일링, 사용자 경험 개선 |
| **tester** | 테스트 전문가 | MEDIUM | 테스트 작성, QA 검증, 버그 재현 |

### 도메인 특화 유형

플러그인 고유 도메인에 맞춰 자유롭게 정의 가능.

| 예시 | 역할 | 설명 |
|------|------|------|
| **scenario-analyst** | 시나리오 분석가 | 비즈니스 시나리오 분석, 위험/기회 요소 도출 |
| **dsl-generator** | DSL 생성기 | 도메인 특화 DSL 코드 자동 생성 |
| **data-processor** | 데이터 처리기 | 데이터 변환, 정제, 통계 분석 |
| **{자유 정의}** | {역할 설명} | 요구사항에 맞는 커스텀 에이전트 |

> 도메인 특화 유형은 이름과 역할을 자유롭게 정의함.
> 에이전트 설계 원칙(역할 단일성, 자율성, 캡슐화)을 준수할 것.

### 유형 선택 가이드

| 질문 | 예 → 유형 |
|------|----------|
| 코드를 작성/수정해야 하는가? | executor |
| 구조를 분석하거나 설계 결정이 필요한가? | architect |
| 코드베이스를 탐색/검색해야 하는가? | explorer |
| 전략적 계획이 필요한가? | planner |
| 산출물을 검토/비평해야 하는가? | reviewer |
| 외부 문서/자료를 조사해야 하는가? | researcher |
| 문서를 작성해야 하는가? | writer |
| 위 유형에 해당하지 않는 도메인 고유 작업인가? | 도메인 특화 유형 정의 |

### 4-Tier 모델

동일 유형을 비용-역량 트레이드오프에 따라 티어별 변형으로 분리 가능.

| 티어 | 모델 등급 | 특성 | 적합한 작업 |
|------|----------|------|------------|
| LOW | Haiku | 빠르고 저비용 | 단건 조회, 간단한 수정 |
| MEDIUM | Sonnet | 균형 | 기능 구현, 일반 분석 |
| HIGH | Opus | 최고 역량 | 복잡한 의사결정, 심층 분석 |
| HEAVY | Opus (대규모) | 최고 역량 + 대규모 예산 | 장시간 추론, 대규모 멀티파일 작업 |

> 하나의 역할에 대해 티어별 변형 에이전트를 만들 수 있음.
> 예: `executor` (MEDIUM) + `executor-high` (HIGH)
>
> 표준 참조: `standards/plugin-standard-agent.md`의 "4-Tier 모델"

[Top](#dmap-플러그인-개발-가이드)

---

## 플러그인 적합여부 판단 기준

요구사항이 DMAP 플러그인으로 구현하기 적합한지 판단하는 기준.

| 기준 | 적합 | 부적합 |
|------|------|--------|
| 반복 가능성 | 반복 사용할 워크플로우 | 일회성 작업 |
| 역할 분리 | 2개 이상 전문가 역할 필요 | 단일 작업 수행 |
| 도구 의존성 | 외부 도구/API 연동 필요 | 순수 대화만으로 해결 |
| 도메인 지식 | 특정 도메인 가이드/참조 필요 | 범용 지식으로 충분 |

**판단 결과별 대응:**

| 결과 | 대응 |
|------|------|
| 적합 | Phase 1 Step 3으로 진행 |
| 부적합 | 사용자에게 검토결과 및 보완사항 추천. 요구사항 수정 후 재판단 |
| 판단 불가 | 사용자에게 추가 정보 요청 |

[Top](#dmap-플러그인-개발-가이드)

---

## 참조 표준 문서

| 문서 | 경로 | 참조 시점 |
|------|------|----------|
| DMAP 빌더 표준 | `standards/plugin-standard.md` | 전체 아키텍처, 디렉토리 구조, 배포 |
| Agent 표준 | `standards/plugin-standard-agent.md` | Step 12: 에이전트 개발 |
| Skill 표준 | `standards/plugin-standard-skill.md` | Step 13: 스킬 개발 |
| Gateway 표준 | `standards/plugin-standard-gateway.md` | Step 10: Gateway 설정 |
| 리소스 마켓플레이스 | `resources/plugin-resources.md` | Step 5: 공유 자원 선택, Step 19: 공유자원 등록 |

[Top](#dmap-플러그인-개발-가이드)
